<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Firebase Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
     ma       margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { background: #d4edda; color: #155724; border: 2px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border: 2px solid #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border: 2px solid #17a2b8; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }
        h1 { color: #333; }
        h3 { color: #666; margin-top: 20px; }
    </style>
</head>
<body>
<h1>üî• Simple Firebase Connection Test</h1>

<div id="status" class="box info">
    <strong>Status:</strong> Loading...
</div>

<div class="box">
    <h3>Step 1: Check Scripts</h3>
    <button onclick="checkScripts()">Check If Scripts Loaded</button>
    <div id="scriptStatus"></div>
</div>

<div class="box">
    <h3>Step 2: Test Connection</h3>
    <button onclick="testConnection()">Test Firebase Connection</button>
    <div id="connectionStatus"></div>
</div>

<div class="box">
    <h3>Step 3: Read Database</h3>
    <button onclick="readDatabase()">Try Reading Database</button>
    <div id="readStatus"></div>
</div>

<div class="box">
    <h3>Step 4: List Patients</h3>
    <button onclick="listPatients()">List All Patients</button>
    <div id="patientsStatus"></div>
    <pre id="patientsData"></pre>
</div>

<div class="box">
    <h3>Console Log</h3>
    <pre id="log"></pre>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>

    // Custom logger
    function log(message) {
        const logEl = document.getElementById('log');
        const timestamp = new Date().toLocaleTimeString();
        logEl.textContent += `[${timestamp}] ${message}\n`;
        console.log(message);
    }

    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyC-NYOlKhFKQGsQR310oYIqjrVkiiNCaDw",
        authDomain: "emergencymedical-a43a9.firebaseapp.com",
        databaseURL: "https://emergencymedical-a43a9-default-rtdb.firebaseio.com",
        projectId: "emergencymedical-a43a9",
        storageBucket: "emergencymedical-a43a9.firebasestorage.app",
        messagingSenderId: "493706183621",
        appId: "1:493706183621:web:d1d0aeac356e53004cc1ac"
    };

    let database;

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', function() {
        const statusEl = document.getElementById('status');

        try {
            log('Checking if firebase is defined...');
            if (typeof firebase === 'undefined') {
                statusEl.className = 'box error';
                statusEl.innerHTML = '<strong>‚ùå ERROR:</strong> Firebase scripts did not load!<br><small>Check your internet connection or firewall.</small>';
                log('ERROR: firebase is undefined');
                return;
            }

            log('Firebase object found! Initializing...');
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();

            statusEl.className = 'box success';
            statusEl.innerHTML = '<strong>‚úÖ SUCCESS:</strong> Firebase initialized!<br><small>Project: emergencymedical-a43a9</small>';
            log('Firebase initialized successfully');

        } catch (error) {
            statusEl.className = 'box error';
            statusEl.innerHTML = `<strong>‚ùå ERROR:</strong> ${error.message}`;
            log('ERROR: ' + error.message);
        }
    });

    function checkScripts() {
        const statusDiv = document.getElementById('scriptStatus');
        log('Checking scripts...');

        let html = '<div style="margin-top: 10px;">';

        if (typeof firebase !== 'undefined') {
            html += '<div class="box success">‚úÖ Firebase SDK loaded</div>';
            log('Firebase SDK: OK');
        } else {
            html += '<div class="box error">‚ùå Firebase SDK NOT loaded</div>';
            log('Firebase SDK: FAILED');
        }

        if (typeof firebase !== 'undefined' && firebase.database) {
            html += '<div class="box success">‚úÖ Firebase Database module loaded</div>';
            log('Firebase Database: OK');
        } else {
            html += '<div class="box error">‚ùå Firebase Database module NOT loaded</div>';
            log('Firebase Database: FAILED');
        }

        html += '</div>';
        statusDiv.innerHTML = html;
    }

    function testConnection() {
        const statusDiv = document.getElementById('connectionStatus');
        statusDiv.innerHTML = '<div class="box info">‚è≥ Testing connection...</div>';
        log('Testing connection to Firebase...');

        if (!database) {
            statusDiv.innerHTML = '<div class="box error">‚ùå Database not initialized</div>';
            log('ERROR: Database not initialized');
            return;
        }

        database.ref('.info/connected').once('value')
            .then(snapshot => {
                if (snapshot.val()) {
                    statusDiv.innerHTML = '<div class="box success">‚úÖ Connected to Firebase!</div>';
                    log('Connection test: SUCCESS');
                } else {
                    statusDiv.innerHTML = '<div class="box error">‚ùå Not connected to Firebase</div>';
                    log('Connection test: FAILED (not connected)');
                }
            })
            .catch(error => {
                statusDiv.innerHTML = `<div class="box error">‚ùå Error: ${error.message}</div>`;
                log('Connection error: ' + error.message);
            });
    }

    function readDatabase() {
        const statusDiv = document.getElementById('readStatus');
        statusDiv.innerHTML = '<div class="box info">‚è≥ Reading database...</div>';
        log('Attempting to read database...');

        if (!database) {
            statusDiv.innerHTML = '<div class="box error">‚ùå Database not initialized</div>';
            log('ERROR: Database not initialized');
            return;
        }

        database.ref('patients').once('value')
            .then(snapshot => {
                if (snapshot.exists()) {
                    const count = Object.keys(snapshot.val()).length;
                    statusDiv.innerHTML = `<div class="box success">‚úÖ Successfully read database! Found ${count} patient(s)</div>`;
                    log(`Database read: SUCCESS (${count} patients)`);
                } else {
                    statusDiv.innerHTML = '<div class="box info">‚úÖ Database read successful, but no patients found</div>';
                    log('Database read: SUCCESS (empty)');
                }
            })
            .catch(error => {
                statusDiv.innerHTML = `<div class="box error">‚ùå Error: ${error.code} - ${error.message}</div>`;
                log(`Database read error: ${error.code} - ${error.message}`);

                if (error.code === 'PERMISSION_DENIED') {
                    statusDiv.innerHTML += '<div class="box error" style="margin-top: 10px;"><strong>Fix:</strong> Update Firebase database rules</div>';
                }
            });
    }

    function listPatients() {
        const statusDiv = document.getElementById('patientsStatus');
        const dataDiv = document.getElementById('patientsData');

        statusDiv.innerHTML = '<div class="box info">‚è≥ Fetching patients...</div>';
        dataDiv.textContent = '';
        log('Fetching all patients...');

        if (!database) {
            statusDiv.innerHTML = '<div class="box error">‚ùå Database not initialized</div>';
            log('ERROR: Database not initialized');
            return;
        }

        database.ref('patients').once('value')
            .then(snapshot => {
                if (snapshot.exists()) {
                    const patients = snapshot.val();
                    const patientIds = Object.keys(patients);

                    statusDiv.innerHTML = `<div class="box success">‚úÖ Found ${patientIds.length} patient(s)</div>`;
                    log(`Found ${patientIds.length} patients`);

                    const patientInfo = patientIds.map(id => {
                        const patient = patients[id];
                        return {
                            id: id,
                            name: patient.personalInfo?.name || 'N/A',
                            age: patient.personalInfo?.age || 'N/A',
                            bloodGroup: patient.personalInfo?.bloodGroup || 'N/A'
                        };
                    });

                    dataDiv.textContent = JSON.stringify(patientInfo, null, 2);
                } else {
                    statusDiv.innerHTML = '<div class="box info">‚ÑπÔ∏è No patients found in database</div>';
                    dataDiv.textContent = 'The "patients" node is empty.';
                    log('No patients found (database empty)');
                }
            })
            .catch(error => {
                statusDiv.innerHTML = `<div class="box error">‚ùå Error: ${error.code} - ${error.message}</div>`;
                dataDiv.textContent = `Error details:\n${error.toString()}`;
                log(`Error listing patients: ${error.code} - ${error.message}`);
            });

}
</script>
</body>
</html>
